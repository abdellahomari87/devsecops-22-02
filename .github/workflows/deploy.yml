- name: Install dependencies
  run: npm install
  working-directory: serverless-api

- name: Run tests
  run: npm test
  working-directory: serverless-api

- name: Zip Lambda function
  run: zip -r function.zip . -x "*.git*" "*.github*" "terraform/*"
  working-directory: serverless-api

- name: Deploy to AWS Lambda
  env:
    AWS_ACCESS_KEY_ID: ${{ secrets.aws_access_key_ID }}
    AWS_SECRET_ACCESS_KEY: ${{ secrets.aws_secret_access_key }}
    AWS_REGION: us-east-1
  run: |
    aws lambda update-function-code \
      --function-name serverless_api \
      --zip-file fileb://serverless-api/function.zip \
      --region $AWS_REGION
