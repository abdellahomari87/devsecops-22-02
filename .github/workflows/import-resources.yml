name: Terraform Import Existing Resources

on:
  workflow_dispatch:  # Lancement manuel

jobs:
  terraform-import:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: 1.5.6

      - name: Terraform Init
        run: terraform init
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.aws_access_key_id }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.aws_secret_access_key }}

      - name: Import existing resources into Terraform state
        run: |
          terraform import aws_iam_policy.S3_policy arn:aws:iam::${{ secrets.aws_account_id }}:policy/WebAppS3
          terraform import aws_iam_role.lambda_s3_aurora lambda-s3
          terraform import aws_iam_policy.lambda_eni_policy arn:aws:iam::${{ secrets.aws_account_id }}:policy/eni_policy
          terraform import aws_rds_cluster.aurora_cluster serverless-cluster
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.aws_access_key_id }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.aws_secret_access_key }}
